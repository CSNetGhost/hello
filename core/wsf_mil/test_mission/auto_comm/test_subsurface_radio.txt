# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# Copyright 2016 Infoscitex, a DCS Company. All rights reserved.
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

# Requires the wsf_mil extension
test_feature wsf_mil

script_variables
   int numMsgsRcvd = 0;
   int expectedResult = 1;
end_script_variables

script void MessageReceived(WsfComm aXmtr, WsfComm aRcvr, WsfMessage aMsg, WsfCommInteraction aResult)
   extern int numMsgsRcvd;
   if (aRcvr.Platform().Name() == "Listener")
   {
      numMsgsRcvd = numMsgsRcvd + 1;
   }
   writeln("Message received.");
end_script

observer
   enable MESSAGE_RECEIVED
end_observer

comm Radio_A WSF_SUBSURFACE_RADIO_TRANSCEIVER
   on
   transmitter
      frequency 10 hz
   end_transmitter
   receiver
      frequency 10 hz
   end_receiver
end_comm

platform Talker WSF_PLATFORM
   add comm talker Radio_A
   end_comm

   execute at_time 10 seconds absolute
      WsfMessage hello = WsfMessage();
      PLATFORM.Comm("talker").SendMessage(hello, "Listener", "listener_on_a");
   end_execute
end_platform

platform Listener WSF_PLATFORM
   add comm listener_on_a Radio_A
   end_comm
end_platform

execute at_time 20 seconds absolute
   extern int numMsgsRcvd;

   if (numMsgsRcvd != 1)
   {
      writeln("-FAIL-");
   }
   else
   {
      writeln("-PASS-");
   }
   WsfSimulation.Terminate();
end_execute

end_time 100 seconds
