# ****************************************************************************
# CUI//REL TO USA ONLY
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

# * * ************************************** * *
# *   ****** Demonstration input file ******   *
# *   ******      UNCLASSIFIED        ******   *
# * * ************************************** * *

# *******************************************************************************************
# File Log
# 11/11/15 - J.Iffrig - This model takes positional updates via datalink during the simulation. 
#	WSF indicates a "direct hit" detonation if the weapon detonates within 30 meters of 
#	the target. However the weapon doesn't get with 30 meters very often. This needs to be
#	addressed.  
# ******************************************************************************************


#include_once ../../link16/jtids.txt

###############################################################################
#
#                               UNCLASSIFIED
#
#   ARGS-54 seeker for SS-N-21 Sampson ASM
#
#   Sources:
#
#     1.  Jane's
#
###############################################################################

antenna_pattern ARGS-54_ANTENNA
  sine_pattern
     peak_gain            31 db            # computed using 420 mm dia & 9 GHz
     minimum_gain         -10 db           # unknown
     azimuth_beamwidth    4.6 deg          # 420 mm dia & 9 GHz
     elevation_beamwidth  4.6 deg          # 420 mm dia & 9 GHz
  end_sine_pattern
end_antenna_pattern

filter FILTER_TACTICS WSF_KALMAN_FILTER
   range_measurement_sigma       50. m
   bearing_measurement_sigma     0.1 deg
   elevation_measurement_sigma   0.1 deg

   # values for maneuvering targets (per Erik)
   process_noise_sigmas_XYZ  50 50 30
end_filter

sensor ARGS-54 WSF_RADAR_SENSOR
  
  #show_calibration_data

  maximum_request_count          1

  frame_time                     1.0 sec       # unknown

  one_m2_detect_range            10 km         # unknown

  maximum_range                  60 km         # Ref 1

  slew_mode                      azimuth_and_elevation   # Ref 1
  azimuth_slew_limits            -45.0 deg 45.0 deg      # Ref 1
  elevation_slew_limits          -20.0 deg 10.0 deg      # Ref 1

  scan_mode                      azimuth_and_elevation
  azimuth_scan_limits            -45.0 deg 45.0 deg
  elevation_scan_limits          -20.0 deg 10.0 deg

  transmitter
     antenna_pattern             ARGS-54_ANTENNA
     power                       500 w         # unknown
     frequency                   9000 mhz      # assuming X-band
     pulse_width                 1.0 usec      # unknown
     pulse_repetition_frequency  3600 hz       # unknown
  end_transmitter

  receiver
     antenna_pattern             ARGS-54_ANTENNA
     bandwidth                   1.0 mhz       # use inverse of pulse width
  end_receiver

  hits_to_establish_track  2 2    # guess
  hits_to_maintain_track   1 3

  track_quality            1.0    # 'weapons' grade

  reports_range
  reports_bearing
  reports_elevation
  // BAR
  reports_location
  #deprecated reports_spatial_domain surface
end_sensor

sensor SIMPLE_SEEKER_TYPE WSF_RADAR_SENSOR
   frame_time 1.0 seconds

   one_m2_detect_range 19 nm

   transmitter
      frequency 1.0 ghz
      power     0.01 mw
   end_transmitter

   reports_location
   reports_velocity
end_sensor


infrared_signature TEST_INFRARED_SIGNATURE
   constant 1 watts/steradian
end_infrared_signature

optical_signature  TEST_OPTICAL_SIGNATURE
   constant 1 m^2
end_optical_signature

radar_signature    TEST_RADAR_SIGNATURE
   constant 1 m^2
end_radar_signature

aero GUESSED_AERO WSF_AERO
   // This is actually for an AIM-9X missile, but we will assume similarity
   mach_and_cd    0.0 1.25 # ref AIAA 79-0091
   mach_and_cd    0.8 1.25 # ref AIAA 79-0091
   mach_and_cd    1.0 1.65 # ref AIAA 79-0091
   mach_and_cd    1.2 1.75 # ref AIAA 79-0091
   mach_and_cd    1.5 1.6  # ref AIAA 79-0091
   mach_and_cd    2.0 1.45 # ref AIAA 79-0091
   mach_and_cd    3.0 1.1  # ref AIAA 79-0091
   mach_and_cd    4.0 1.0  # ref AIAA 79-0091

   reference_area  0.02488 m2  # 17.8 cm dia (Wikipedia)
  #cl_max         10.0         # Unknown
  #aspect_ratio   17.7         # Unknown
   cl_max         15.0         # Unknown
   aspect_ratio   25.0         # Unknown
end_aero

platform_type AIM120 WSF_PLATFORM

  weapon_effects weaponDamage
  
   comm j11_comm J11_COMM
      processor l16_computer
      processor track-processor
   end_comm 
   
   processor l16_computer FIGHTER_LINK16_COMPUTER_IN
      decimal_track_number 120
      comm j11_comm   
   end_processor
   
   # The command_chain slot group key entry defined in the NETWORK_ENABLED_WEAPON message processor    
   # is used to find the command_chain of the same name on the platform (as defined below)               
   # to determine if the messages are to be sent onto any other WSF platforms (similar to
   # an external link command)
   #             
   command_chain WEAPON_GRP_KEY   SELF   
   
   # The command_chain slot group key entry defined in the SCRIPTED message processor    
   # is used to find the command_chain of the same name on the platform (as defined below)               
   # to determine if the messages are to be sent onto any other WSF platforms (similar to
   # an external link command)
   #              
   command_chain SCRIPTED_GRP_KEY SELF
   
   #processor dis-data-link WSF_DATALINK_PROCESSOR
   #   update_interval 1.0 s
   #   debug_message tdltype_120_location_data
   #   processor track-processor
   #end_processor
   
   processor track-processor WSF_WEAPON_TRACK_PROCESSOR
      on
      update_interval 1 sec
   end_processor
   
  icon SA-10_Missile
  infrared_signature TEST_INFRARED_SIGNATURE
  optical_signature  TEST_OPTICAL_SIGNATURE
  radar_signature    TEST_RADAR_SIGNATURE

 #mover WSF_OLD_GUIDED_MOVER
  mover WSF_GUIDED_MOVER
   #thrust             2500.0 lbf
   #fuel_mass            55.0 kg
   #specific_impulse    250.0 sec
   #thrust_duration    12.12 sec

    total_mass          150.0  kg
    fuel_mass            80.0  kg
    thrust_duration      40.0  sec
    burn_rate             2.0  kg/s
    specific_impulse    907.18 sec
    thrust             4000.0  lbf
    update_interval       0.1  sec
    aero GUESSED_AERO 
    #show_status # Turns on some mass properties diagnostic output
  end_mover

  processor autopilot WSF_GUIDANCE_COMPUTER
    proportional_navigation_gain  30.0
    velocity_pursuit_gain         30.0
    g_bias                         1.2
    #continuous_g_bias
    max_commanded_g               40.0 g
    #omit_velocity_pursuit
    update_interval                0.1 s
  end_processor

#  processor seeker WSF_PERFECT_TRACKER
#    update_interval 0.10 s
#  end_processor

   sensor simple_seeker  SIMPLE_SEEKER_TYPE
      off
      
      #debug
   end_sensor 

   processor fuse WSF_WEAPON_FUSE
      update_interval 0.5 s
      maximum_time_of_flight 45 s
      gross_proximity_range 1200 m
      fine_update_interval 0.1 s
      hit_proximity_range 10 nm #500 m
      #do_not_use_current_target
      
      detonate_below_height_AGL 0.0 ft
   end_processor

   execute at_interval_of 1 s
     #writeln("WEAPON Location = ", PLATFORM.Latitude(), " ", PLATFORM.Longitude(), " ", PLATFORM.Altitude()*Math.FT_PER_M());
     if (PLATFORM.HasCurrentTarget())
     {
        #writeln("WEAPON has a current target");
        WsfTrack track = PLATFORM.CurrentTargetTrack();
        double slantRange = PLATFORM.SlantRangeTo(track);
        WsfSensor sensor = PLATFORM.Sensor("simple_seeker");
        if (sensor.IsValid())
        {
           #writeln("WEAPON SENSOR is valid");
           
           #if (sensor.IsTurnedOff()) writeln("SENSOR is OFF");
           #else writeln("SENSOR is ON");
           
           double slantRangeNM = slantRange / MATH.M_PER_NM();
           #writeln("SLANT RANGE TO TRACK = ", slantRangeNM, " nm");
           
           if ((sensor.IsTurnedOff()) && (slantRangeNM < 20))
           {
              sensor.TurnOn();
              sensor.StartTracking(track, "default");
              #writeln("WEAPON SENSOR TURNED ON");
           }
           if ((sensor.IsTurnedOn()) && (sensor.ActiveTrackCount() > 0))
           {
              writeln("PASS - sensor is ON and has own track");
           #  writeln("WEAPON SENSOR IS TRACKING TARGET");
           #   writeln("TRACK is from sensor ", track.SensorType());
           }
        }
     }
   end_execute
end_platform_type


weapon_effects weaponDamage WSF_SPHERICAL_LETHALITY
   # A Pk of 1.0 is needed for weapon launch computer generation.
   minimum_radius  1 m # BAR was 0
   maximum_radius 30 m #this one directly effects the detonation status.
   minimum_damage 0.99
   maximum_damage 1
   exponent 1
   threshold_damage 0.0
   allow_incidental_damage
end_weapon_effects

### A weapon can have the same name as its launched platform type
weapon AIM120C WSF_EXPLICIT_WEAPON
   launched_platform_type AIM120

   location 0.0 0.0 1.0 meters
   weapon_effects weaponDamage

   #quantity               4

   #firing_delay           0.5 sec
   salvo_interval         5.0 sec

   slew_mode              azimuth_and_elevation
   azimuth_slew_limits    -180.0 deg 180.0 deg
   elevation_slew_limits  10.0 deg  70.0 deg
end_weapon

weapon AIM120L WSF_EXPLICIT_WEAPON
   launched_platform_type AIM120

   location 0.0 -5.0 1.0 meters
   weapon_effects weaponDamage

   #quantity               4

   firing_delay           0.5 sec
   salvo_interval         5.0 sec

   slew_mode              azimuth_and_elevation
   azimuth_slew_limits    -180.0 deg 180.0 deg
   elevation_slew_limits  10.0 deg  70.0 deg
end_weapon

weapon AIM120R WSF_EXPLICIT_WEAPON
   launched_platform_type AIM120

   location 0.0 5.0 1.0 meters
   weapon_effects weaponDamage

   #quantity               4

   firing_delay           0.5 sec
   salvo_interval         5.0 sec

   slew_mode              azimuth_and_elevation
   azimuth_slew_limits    -180.0 deg 180.0 deg
   elevation_slew_limits  10.0 deg  70.0 deg
end_weapon
