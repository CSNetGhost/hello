# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

// Test movers GoToLocation method with a callback appended to last waypoint
//    insure callback occurs only once.
//////////////////////////////////////////////

end_time 20 s

platform test_plat WSF_PLATFORM
   add mover WSF_AIR_MOVER
      route
         position 31n 110w altitude 10000 ft agl speed 100 knots
         position 32n 110w altitude 10000 ft agl speed 100 knots
      end_route
      update_interval 1 s // otherwise mover never updates
   end_mover
   execute at_time 10 s absolute
      PLATFORM.GoToLocation(MATH.StringToLat("31:00:15n"), MATH.StringToLon("110:00:15w"), MATH.M_PER_FT() * 10000);
      WsfRoute newRoute = PLATFORM.Route().Copy();
      newRoute.AddCallbackToLastWaypoint("test_script");
      FollowRoute(newRoute);
   end_execute
   script_variables
      bool pass = false;
   end_script_variables
   script void test_script()
      static bool haveExecutedOnce = false;
      pass = !haveExecutedOnce;
      haveExecutedOnce = true;
   end_script
   script void on_platform_deleted()
      if (pass)
      {
         writeln("-PASS-");
      }
      else
      {
         writeln("-FAIL-");
      }
   end_script
end_platform

