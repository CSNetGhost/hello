# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

# Test platform 'appearance' changes.

include_once ../auto_script/test_functions.txt

radar_signature TEST_RADAR_SIG
   state other
      constant 10 m^2
   state default
      constant 0 m^2
end_radar_signature

platform test WSF_PLATFORM
   radar_signature    TEST_RADAR_SIG

   script_variables
      bool mPass = true;
   end_script_variables

   execute at_time 0.1 sec relative
      writeln(" Radar: ", RadarSigState());
   end_execute

   execute at_time 1 sec relative
      extern bool AssertStringEqualsMessage(string,string,string);
      SetRadarSigState("other");
      mPass = AssertStringEqualsMessage("other", RadarSigState(), "RadarSigState(other)") && mPass;
   end_execute

   execute at_time 2 sec relative
      extern bool AssertStringEqualsMessage(string,string,string);
      SetRadarSigState("default");
      mPass = AssertStringEqualsMessage("default", RadarSigState(), "RadarSigState(other)") && mPass;
   end_execute

   execute at_time 11 sec relative
      extern bool AssertDoubleEqualsMessage(double,double,string);
      SetConcealmentFactor(1.0);
      mPass = AssertDoubleEqualsMessage(1.0, ConcealmentFactor(), "ConcealmentFactor(1.0)") && mPass;
   end_execute

   execute at_time 12 sec relative
      extern bool AssertDoubleEqualsMessage(double,double,string);
      SetConcealmentFactor(0.0);
      mPass = AssertDoubleEqualsMessage(0.0, ConcealmentFactor(), "ConcealmentFactor(0.0)") && mPass;
   end_execute

   execute at_time 21 sec relative
      extern bool AssertDoubleEqualsMessage(double,double,string);
      SetAppearance(0, 1, 1);
      mPass = AssertDoubleEqualsMessage(1, Appearance(), "Appearance(0, 1, 1)") && mPass;
   end_execute

   execute at_time 22 sec relative
      extern bool AssertDoubleEqualsMessage(double,double,string);
      SetAppearance(0, 1, 0);
      mPass = AssertDoubleEqualsMessage(0, Appearance(), "Appearance(0, 1, 0)") && mPass;
   end_execute

   script void on_platform_deleted()
      extern void writePass(bool);
      writePass(mPass);
   end_script

end_platform

end_time 60 secs

script void PlatformAppearanceChanged(WsfPlatform aPlatform, string aItem)
   writeln("T=", TIME_NOW, " Platform appearance changed for platform: ", aPlatform.Name(),
           ", item: ", aItem);
end_script

observer
   enable PLATFORM_APPEARANCE_CHANGED PlatformAppearanceChanged
end_observer
/*
event_output
   file replay.evt
   enable PLATFORM_ADDED
   enable PLATFORM_APPEARANCE_CHANGED
   enable PLATFORM_DELETED
end_event_output
*/
