# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

// This test covers:
//    1) Multiple table inputs by table mode
//    2) Table mode selection
//    3) Consumption rates for modes
//    4) Single altitude/rate input

platform_type FUEL_TEST_TYPE WSF_PLATFORM
   side blue
   spatial_domain air

   mover WSF_AIR_MOVER
   end_mover

   fuel WSF_VARIABLE_RATE_FUEL
      maximum_quantity 7000 kg
      initial_quantity 6750 kg
      reserve_quantity 1500 kg

      table_for_mode CONSTANT
      rates
         altitude 0.0 m
            speed 100 m/s rate 4.0 kg/s
      end_rates

      table_for_mode MODE1
      rates
         altitude 0.0 m
            speed 100 m/s rate 3.0 kg/s
            speed 300 m/s rate 4.5 kg/s
            speed 500 m/s rate 5.5 kg/s
            speed 700 m/s rate 7.0 kg/s
         altitude 5000.0 m
            speed 100 m/s rate 2.0 kg/s
            speed 300 m/s rate 3.5 kg/s
            speed 500 m/s rate 4.5 kg/s
            speed 700 m/s rate 6.0 kg/s
         altitude 10000.0 m
            speed 100 m/s rate 1.0 kg/s
            speed 300 m/s rate 2.5 kg/s
            speed 500 m/s rate 3.5 kg/s
            speed 700 m/s rate 5.0 kg/s
      end_rates

      table_for_mode MODE2 // Added 1.0 to each rate in mode 1
      rates
         altitude 0.0 m
            speed 100 m/s rate 4.0 kg/s
            speed 300 m/s rate 5.5 kg/s
            speed 500 m/s rate 6.5 kg/s
            speed 700 m/s rate 8.0 kg/s
         altitude 5000.0 m
            speed 100 m/s rate 3.0 kg/s
            speed 300 m/s rate 4.5 kg/s
            speed 500 m/s rate 5.5 kg/s
            speed 700 m/s rate 7.0 kg/s
         altitude 10000.0 m
            speed 100 m/s rate 2.0 kg/s
            speed 300 m/s rate 3.5 kg/s
            speed 500 m/s rate 4.5 kg/s
            speed 700 m/s rate 6.0 kg/s
      end_rates

   end_fuel
end_platform_type


script_variables
   double mMode1Passed = false;
   double mMode2Passed = false;
   double mConstantPassed = false;
end_script_variables


platform FUEL_TEST_AC_1 FUEL_TEST_TYPE
   update_interval 0.01 sec
   execute at_time 1.0 sec absolute
      WsfFuel fuel = PLATFORM.Fuel();
      fuel.SelectMode("MODE1");
      if (fuel.IsValid())
      {
         double rate1 = fuel.ConsumptionRate(2500, 250);
         double rate2 = fuel.ConsumptionRate(7500, 250);
         double rate3 = fuel.ConsumptionRate(2500, 350);
         double rate4 = fuel.ConsumptionRate(7500, 350);
         # writeln("rate1: ", rate1, "  rate2: ", rate2, "  rate3: ", rate3, "  rate4: ", rate4);
         if(rate1 == 3.625 &&
            rate2 == 2.625 &&
            rate3 == 4.25  &&
            rate4 == 3.25 )
         {
            mMode1Passed = true;
         }
         else
         {
            writeln("--FAIL-- Rates for Mode 1 are incorrect.");
         }
      }
   end_execute
end_platform


platform FUEL_TEST_AC_2 FUEL_TEST_TYPE
   update_interval 0.01 sec
   execute at_time 1.0 sec absolute
      WsfFuel fuel = PLATFORM.Fuel();
      fuel.SelectMode("MODE2");
      if (fuel.IsValid())
      {
         double rate1 = fuel.ConsumptionRate(2500, 250);
         double rate2 = fuel.ConsumptionRate(7500, 250);
         double rate3 = fuel.ConsumptionRate(2500, 350);
         double rate4 = fuel.ConsumptionRate(7500, 350);
         #  writeln("rate1: ", rate1, "  rate2: ", rate2, "  rate3: ", rate3, "  rate4: ", rate4);
         if(rate1 == 4.625 &&
            rate2 == 3.625 &&
            rate3 == 5.25  &&
            rate4 == 4.25 )
         {
            mMode2Passed = true;
         }
         else
         {
            writeln("--FAIL-- Rates for Constant Mode are incorrect.");
         }
      }
   end_execute
end_platform


platform FUEL_TEST_AC_3 FUEL_TEST_TYPE
   update_interval 0.01 sec
   execute at_time 1.0 sec absolute
      WsfFuel fuel = PLATFORM.Fuel();
      fuel.SelectMode("CONSTANT");
      if (fuel.IsValid())
      {
         double rate1 = fuel.ConsumptionRate(2500, 250);
         double rate2 = fuel.ConsumptionRate(7500, 250);
         double rate3 = fuel.ConsumptionRate(2500, 350);
         double rate4 = fuel.ConsumptionRate(7500, 350);
         #  writeln("rate1: ", rate1, "  rate2: ", rate2, "  rate3: ", rate3, "  rate4: ", rate4);
         if(rate1 == 4.0 &&
            rate2 == 4.0 &&
            rate3 == 4.0 &&
            rate4 == 4.0 )
         {
            mConstantPassed = true;
         }
         else
         {
            writeln("--FAIL-- Rates for Mode 2 are incorrect.");
         }
      }
   end_execute
end_platform

execute at_time 2 s absolute
   extern double mMode1Passed;
   extern double mMode2Passed;
   extern double mConstantPassed;

   if (mMode1Passed && mMode2Passed && mConstantPassed)
   {
      writeln("--PASS--");
   }
   else
   {
      writeln("--FAIL--");
   }
end_execute
