# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

# EZJA test case 6
# Four stationary targets are spread 90 degrees apart from each other

include_once spin_scheduler_resources.txt
include_once ../auto_script/test_functions.txt

observer 
   enable SENSOR_DETECTION_ATTEMPT 
end_observer

script_variables 
   string last_detected_platform = "";
   double last_detected_time = -1.0;
end_script_variables

execute at_time .0001 sec absolute 
   WsfSimulation.DeletePlatform("sam_1");
end_execute

script void SensorDetectionAttempt(WsfPlatform aPlatform, WsfSensor aSensor, WsfPlatform aTarget, WsfSensorInteraction aResult)
   if (aPlatform.Name() == "200_ew_radar")
   {
      if (last_detected_platform == "" || last_detected_time == -1.0)
      {
         last_detected_platform = aTarget.Name();
         last_detected_time = TIME_NOW;
         return;
      }
   
      AssertTrueMessage(TIME_NOW > last_detected_time, "Timing of detections is incorrect");
      AssertTrueMessage(aTarget.Name() == aTarget.Name().Substring(0, -1) + (string)(Math.Mod((int)last_detected_platform.Substring(-1)+2, 4)+1),
         "Platforms detected out of order");
      last_detected_platform = aTarget.Name();
      last_detected_time = TIME_NOW;
   }
end_script

# 0 deg
platform bomber_case_6_1 BOMBER 
   position 30:35n 81:25w
   side red
   altitude 30000 feet
   heading 270 degrees
end_platform
# 90 deg
platform bomber_case_6_2 BOMBER 
   position 30:36n 81:30w
   side red
   altitude 30000 feet
   heading 270 degrees
end_platform
# 180 deg
platform bomber_case_6_3 BOMBER 
   position 30:35n 81:31w
   side red
   altitude 30000 feet
   heading 270 degrees
end_platform

# 270 deg
platform bomber_case_6_4 BOMBER 
   position 30:34n 81:30w
   side red
   altitude 30000 feet
   heading 270 degrees
end_platform
