# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

# Test that the state machine isn't severely broken

script_variables
   int passCount = 0;
end_script_variables

processor statemachine WSF_STATE_MACHINE
   # Configuring an update interval is unusual on this processor but is added
   # here to test that evaluation does not occur on updates (only on-demand)
   update_interval 2 s
   script void EvaluateState()
      STATE_MACHINE.Evaluate("X");
   end_script
   state X
      next_state Y
         return true;
      end_next_state
      on_exit
         passCount += 1;
      end_on_exit
   end_state
   state Y
      on_entry
         passCount += 1;
      end_on_entry
   end_state
end_processor

platform p WSF_PLATFORM
   add processor sm statemachine
      execute at_time 1 s absolute
         EvaluateState();
         if (passCount == 2) writeln("-PASS-");
         else writeln("-FAIL-");
      end_execute
   end_processor
end_platform
