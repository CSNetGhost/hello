# ****************************************************************************
# CUI//REL TO USA ONLY
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

test_feature brawler

file_path .
file_path ../data
#file_path p6dof_data/

end_time 200 sec

# Brings in the P6DOF configuration
#include_once P6DOF_Environment.txt
#include_once F104_Empty.txt

#weapon
include_once aim-9x.txt   #TODO - give it limited IR seekers, not perfect trackers

#include behavior_default_go_to_location.txt

include brawler_behavior_evaluation_notes.txt

# "CONTEXT-FREE" Maneuvers
include_once behavior_alt3111_straight_level_max_speed.txt
include_once behavior_alt3121_straight_level.txt

include_once behavior_alt3211_route_maneuver.txt

# Offensive 1v1 Maneuvers
include_once behavior_alt3411_straight_flight.txt
include_once behavior_alt3421_roll_+15_pull.txt
include_once behavior_alt3431_roll-15_pull.txt
include_once behavior_alt3441_tail_attack.txt
include_once behavior_alt3451_pull_gmax_sust.txt
include_once behavior_alt3471_slow_current_dir.txt
include_once behavior_alt3472_slow_pull_right.txt
include_once behavior_alt3473_slow_pull_left.txt
include_once behavior_alt3474_slow_pull_current_plane.txt

# Defensive 1v1 Maneuvers
include_once behavior_alt3511_break_right.txt
include_once behavior_alt3531_break_left.txt
include_once behavior_alt3551_run_away.txt
include_once behavior_alt3561_force_overshoot.txt
include_once behavior_alt3581_negative_velocity.txt

#missile aiming maneuever
include_once behavior_alt3841_aim_missile_typ4.txt

include_once behavior_alt3911_evade_missile.txt
include_once behavior_alt3A11_low_speed_recover.txt
include_once behavior_alt3A21_low_speed_recover_right45.txt
include_once behavior_alt3A31_low_speed_recover_left45.txt
include_once behavior_alt3B11_illuminate.txt

#include_once behavior_test_p6dof.txt

# Map P6DOF object and platform types
#p6dof_object_types                 # P6DOF     # platform_type
#   map_p6dof_object_to_platform    F104_Empty  BRAWLER_AIRCRAFT
#end_p6dof_object_types

# A brawler agent must have the following defined:
# 1. A WSF_BRAWLER_MOVER or WSF_P6DOF_MOVER
# 2. A WSF_BRAWLER_PROCESSOR (typically named task_mgr or thinker)
# 3. A WSF_PERCEPTION_PROCESSOR (typically named perception)
# 4. A WSF_THREAT_PROCESSOR (typically named incoming_threats)
platform_type  BLUE_BRAWLER  WSF_PLATFORM
   side blue
   icon F-18

#   mover WSF_P6DOF_MOVER
#      p6dof_object_type  F104_Empty
#   end_mover

   mover WSF_BRAWLER_MOVER
      aero_file ../data/ACFT_BD.FXW
   end_mover


   weapon srm AIM-9X
      quantity 2
   end_weapon

   comm datalink WSF_COMM_TRANSCEIVER
      network_name blue_net
      internal_link data_mgr
      internal_link task_mgr
      #internal_link temp_quantum
      internal_link perception
   end_comm

   sensor simple_sensor WSF_GEOMETRIC_SENSOR
      on
      #azimuth_field_of_view   -45.0 degrees  45.0 degrees
      #elevation_field_of_view  -20.0 degrees   20.0 degrees
      azimuth_field_of_view   -180.0 degrees  180.0 degrees
      elevation_field_of_view  -90.0 degrees   90.0 degrees
      maximum_range 150 km
      frame_time    0.5 sec
      reports_location
      reports_velocity
      reports_range
      reports_iff
      track_quality 1.0
      internal_link data_mgr
      ignore_same_side
   end_sensor

   processor data_mgr WSF_TRACK_PROCESSOR
      purge_interval  60 sec
      report_interval 1.0 sec
      report_to commander via datalink
      fused_track_reporting on
      raw_track_reporting off
   end_processor

   processor perception WSF_PERCEPTION_PROCESSOR
      threat_update_interval 2 sec
      max_threat_load 5
      reports_self on
      report_interval 1.0 sec
      report_to commander via datalink
   end_processor

   processor incoming_threats WSF_THREAT_PROCESSOR
   end_processor

   #when debug: prints maneuver value components of every alternative evaluation!
   #debug
   processor task_mgr WSF_BRAWLER_PROCESSOR
      mind_file ../data/MIND.txt
      # BRAWLER configuration values that control how often
      # consciousness events occur
      time_allowed_per_sector_search 10.0 sec
      #debug
      #show_task_messages
      #update_interval 1 sec
      behavior_tree
         priority_selector
            #when debug: prints precondition score of each selector child behavior
            #debug
            #behavior_node  default_go_to_location
            behavior_node  alt3111_straight_level_max_speed
            behavior_node  alt3121_straight_level
#            behavior_node  alt3211_route_maneuver
            behavior_node  alt3411_straight_flight
            behavior_node  alt3421_roll_15_pull
            behavior_node  alt3431_roll-15_pull
            behavior_node  alt3441_tail_attack
            behavior_node  alt3451_pull_gmax_sust
            behavior_node  alt3471_slow_current_dir
            behavior_node  alt3472_slow_pull_right
            behavior_node  alt3473_slow_pull_left
            behavior_node  alt3474_slow_pull_current_plane
            behavior_node  alt3511_break_right
            behavior_node  alt3531_break_left
            behavior_node  alt3551_run_away
            behavior_node  alt3561_force_overshoot
            behavior_node  alt3581_negative_velocity
            behavior_node  alt3841_aim_missile_typ4
            behavior_node  alt3911_evade_missile
#            behavior_node  alt3A11_low_speed_recover
#            behavior_node  alt3A21_low_speed_recover_right45
#            behavior_node  alt3A31_low_speed_recover_left45
#            behavior_node  alt3B11_illuminate
         end_priority_selector
      end_behavior_tree
   end_processor
end_platform_type



include_once behavior_debug_quantum_tasker.txt
platform_type  BLUE_COMMANDER  WSF_PLATFORM
   side blue
   comm datalink WSF_COMM_TRANSCEIVER
      network_name blue_net
      internal_link data_mgr
      internal_link task_mgr
      internal_link perception
   end_comm
   processor data_mgr WSF_TRACK_PROCESSOR
      master_track_processor
   end_processor
   track_manager
      retain_raw_tracks
      retain_track_history
      uncorrelated_track_drops disable
   end_track_manager
   processor perception WSF_PERCEPTION_PROCESSOR
      #asset_perception truth subordinates
      asset_perception status_messages
   end_processor
   processor task_mgr WSF_QUANTUM_TASKER_PROCESSOR
      #debug
      #show_task_messages
      generator simple_weapon
      evaluator distance
      allocator optimal_profit
      update_interval 0.3 sec
#      behavior_tree
#         behavior_node debug_quantum_tasker
#      end_behavior_tree
   end_processor
end_platform_type



platform blue_cmdr BLUE_COMMANDER
   position 1.0s 1.0e
end_platform



platform blue_1 BLUE_BRAWLER
   commander blue_cmdr

   execute at_interval_of 1 sec
      if (PLATFORM.Altitude() <= 0 ||
          PLATFORM.Speed() <= 0 ||
          PLATFORM.MasterTrackList().Count() <= 0 ||
          PLATFORM.GroundRangeTo(MasterTrackList().Entry(0)) > (10 * MATH.M_PER_NM()))
      {
         WsfSimulation.Terminate();
      }
   end_execute

   # P6DOF must have a minimum of three waypoints
   # and the first point is platform initial location

   route   #behind target:
      position 00:47:22.10s 00:44:55.92e altitude 10000.00 ft  speed 500.0 kts
      position 01:27:22.10s 00:44:55.92e altitude 10000.00 ft  speed 500.0 kts
      position 01:37:22.10s 00:44:55.92e altitude 10000.00 ft  speed 500.0 kts
      position 01:47:22.10s 00:44:55.92e altitude 10000.00 ft  speed 500.0 kts
   end_route

#   route   #in front of target:
#      position 00:55:40.00s 00:43:40.00e  altitude 10000.00 ft  speed 500.0 kts
#      position 00:24:38.83s 00:43:40.00e  altitude 10000.00 ft  speed 500.0 kts
#      position 00:03:40.86n 00:43:40.00e  altitude 10000.00 ft  speed 500.0 kts
##      position 0.5n 0.5e  altitude 10000.0 ft  speed 500.0 kts
##      position 1.0n 1.0e  altitude 10000.0 ft  speed 500.0 kts
#      position 00:39:38.87n 00:44:02.96e  altitude 10000.00 ft  speed 500.0 kts
#    position 01:15:54.97n 00:44:01.95e altitude 10000.00 ft
#    position 02:01:16.35n 00:44:00.69e altitude 10000.00 ft
#   end_route

  heading 0 deg
end_platform

# Red aircraft is used to drive blue maneuerss
platform red_2 WSF_PLATFORM
   side red
   icon SU-27
   add mover WSF_AIR_MOVER
   end_mover
   route
      position 00:51:40.00s 00:44:15.00e  altitude 10000.00 ft  speed 525.0 kts
      position 01:16:43.22s 00:44:15.00e  altitude 10000.00 ft  speed 500.0 kts
   end_route
  heading 180 deg
end_platform

/*
event_output
   file test_maneuver_alternatives.evt
   enable BTREE_NODE_CHILDREN
   enable BTREE_NODE_EXEC
   enable PLATFORM_ADDED
   enable PLATFORM_DELETED
end_event_output

dis_interface
   record test_maneuver_alternatives.rep
   mover_update_timer            1.0 sec
   entity_position_threshold     0.03 m
end_dis_interface
*/

