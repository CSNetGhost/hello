# ****************************************************************************
# CUI
#
# The Advanced Framework for Simulation, Integration, and Modeling (AFSIM)
#
# The use, dissemination or disclosure of data in this file is subject to
# limitation or restriction. See accompanying README and LICENSE for details.
# ****************************************************************************

include_once default_formation.txt
include_once ../scripts/utils.txt

start_date jun 1 2018
start_time 12:00:00.000
end_time 12 min

script_variables 
   bool allPassed = true;
end_script_variables

script void CheckExistence(string aName)
   allPassed = ExpectBool(WsfSixDOF_FormationManager.GetFormation(aName).IsValid(),
              true,
              aName + " should exist") && allPassed;
end_script

script void CheckNonExistence(string aName)
   allPassed = ExpectBool(WsfSixDOF_FormationManager.GetFormation(aName).IsValid(),
              false,
              aName + " should exist") && allPassed;
end_script

execute at_time 1 min absolute
   CheckExistence("yankee");
   CheckExistence("yankee.alpha");
   CheckNonExistence("yankee.gamma");
   CheckNonExistence("bravo");
   CheckNonExistence("bravo.gamma");
end_execute

execute at_time 2 min absolute
   WsfSixDOF_FormationRenameCommand commAlpha = WsfSixDOF_FormationRenameCommand.Construct("gamma");
   commAlpha.SetConstraint(WsfSixDOF_FormationCommandConstraint.AT_TIME(130.0));
   WsfSixDOF_Formation yankeeAlpha = WsfSixDOF_FormationManager.GetFormation("yankee.alpha");
   allPassed = ExpectBool(yankeeAlpha.IsValid(), true, "yankee.alpha should exist") && allPassed;
   yankeeAlpha.ExecuteCommand(commAlpha);

   WsfSixDOF_Formation yankee = WsfSixDOF_FormationManager.GetFormation("yankee");
   allPassed = ExpectBool(yankee.IsValid(), true, "yankee should exist") && allPassed;
   yankee.ExecuteCommand(WsfSixDOF_FormationRenameCommand.Construct("bravo"),
                         WsfSixDOF_FormationCommandConstraint.AT_TIME(300.0));
end_execute

execute at_time 3 min absolute
   CheckExistence("yankee");
   CheckNonExistence("yankee.alpha");
   CheckExistence("yankee.gamma");
   CheckNonExistence("bravo");
   CheckNonExistence("bravo.gamma");
end_execute

execute at_time 10 min absolute
   CheckNonExistence("yankee");
   CheckNonExistence("yankee.alpha");
   CheckNonExistence("yankee.gamma");
   CheckExistence("bravo");
   CheckExistence("bravo.gamma");
end_execute

execute at_time 11 min absolute
   if (allPassed)
   {
      writeln("-PASS-");
   } 
   else
   {
      writeln("-FAIL- One or more tests failed.");
   }    
end_execute